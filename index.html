<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Portail Organisation administrative — République du Congo</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

  <style>
    :root{
      --text:#eef5ff;
      --muted:rgba(238,245,255,.72);
      --line:rgba(255,255,255,.10);
      --green:#16a34a;
      --yellow:#f59e0b;
      --red:#ef4444;
      --radius:16px;
      --shadow:0 12px 30px rgba(0,0,0,.35);
    }

    *{ box-sizing:border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: Arial, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", sans-serif;
      background: radial-gradient(1200px 800px at 20% 0%, rgba(22,163,74,.25), transparent 55%),
                  radial-gradient(900px 700px at 80% 10%, rgba(245,158,11,.22), transparent 55%),
                  radial-gradient(900px 700px at 40% 90%, rgba(239,68,68,.18), transparent 55%),
                  linear-gradient(120deg, #071023, #0b1220);
      color:var(--text);
    }

    header{
      position: sticky;
      top:0;
      z-index: 1000;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      padding: 12px 16px;
      border-bottom:1px solid var(--line);
      background: rgba(11,18,32,.88);
      backdrop-filter: blur(10px);
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width: 0;
    }

    .logoWrap{
      width:52px;
      height:52px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      flex: 0 0 auto;
    }

    .logoWrap img{
      max-height: 44px;
      max-width: 44px;
      width:auto;
      height:auto;
      display:block;
    }

    .brandText{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width: 0;
    }

    .institution{
      font-size: 12px;
      font-weight: 700;
      letter-spacing: .4px;
      text-transform: uppercase;
      color: rgba(238,245,255,.88);
    }

    .title{
      font-size: 15px;
      font-weight: 800;
      line-height: 1.15;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .subtitle{
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .statusPill{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 8px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      box-shadow: 0 6px 18px rgba(0,0,0,.25);
      font-size: 12px;
      font-weight: 700;
      white-space: nowrap;
    }

    .dot{
      width:9px; height:9px; border-radius:999px;
      background: var(--yellow);
      box-shadow: 0 0 0 4px rgba(245,158,11,.15);
    }
    .dot.ok{ background: var(--green); box-shadow: 0 0 0 4px rgba(22,163,74,.18); }
    .dot.bad{ background: var(--red); box-shadow: 0 0 0 4px rgba(239,68,68,.18); }

    .wrap{
      display:grid;
      grid-template-columns: 420px 1fr;
      gap: 14px;
      padding: 14px;
      height: calc(100vh - 78px);
    }

    aside{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(255,255,255,.03);
      box-shadow: var(--shadow);
      padding: 12px;
      overflow:auto;
      min-height: 0;
    }

    .mapwrap{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(255,255,255,.03);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height: 0;
    }

    .maphead{
      padding: 10px 12px;
      border-bottom: 1px solid var(--line);
      background: rgba(0,0,0,.16);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .badgeRow{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap: wrap;
    }

    .miniBadge{
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      color: rgba(238,245,255,.9);
    }

    #map{ flex:1; min-height: 0; }

    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: rgba(0,0,0,.14);
      padding: 12px;
      margin-bottom: 12px;
    }

    .cardTitle{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      font-weight: 800;
      margin-bottom: 10px;
      font-size: 13px;
    }

    .label{
      display:block;
      font-size: 12px;
      color: rgba(238,245,255,.82);
      margin-bottom: 6px;
    }

    select{
      width:100%;
      padding: 10px 12px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.22);
      color: var(--text);
      outline:none;
    }

    .check{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 8px 10px;
      border-radius: 12px;
      border:1px solid var(--line);
      background: rgba(0,0,0,.18);
      margin-bottom: 8px;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 10px 12px;
      border-radius: 12px;
      border:1px solid var(--line);
      text-decoration:none;
      color: var(--text);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{ background: rgba(255,255,255,.10); }

    .hint{
      font-size: 12px;
      color: var(--muted);
      line-height: 1.4;
      margin-top: 8px;
    }

    .dl{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top: 8px;
    }
    .dlItem{
      border:1px solid var(--line);
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(0,0,0,.18);
    }
    .dlTitle{
      font-weight:800;
      font-size:13px;
      margin-bottom:6px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .dlLinks{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .tag{
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      color: rgba(238,245,255,.9);
    }
    .tag.admin{ border-color: rgba(22,163,74,.35); }
    .tag.points{ border-color: rgba(245,158,11,.35); }
    .tag.routes{ border-color: rgba(239,68,68,.35); }

    .leaflet-popup-content-wrapper{ border-radius: 14px; }

    @media (max-width: 1100px){
      .wrap{ grid-template-columns: 1fr; height: auto; }
      .mapwrap{ height: 70vh; }
      .title,.subtitle{ white-space: normal; }
    }
  </style>
</head>

<body>
  <header>
    <div class="brand">
      <div class="logoWrap" title="Institut Géographique National">
        <img src="assets/ign_logo.png" alt="IGN">
      </div>
      <div class="brandText">
        <div class="institution">Institut Géographique National</div>
        <div class="title">Portail Organisation Administrative — République du Congo</div>
        <div class="subtitle">Visualisation & téléchargement : limites administratives, localités (chefs-lieux) et réseau routier structurant</div>
      </div>
    </div>

    <div class="statusPill" id="statusPill">
      <span class="dot" id="statusDot"></span>
      <span id="statusText">Chargement…</span>
    </div>
  </header>

  <div class="wrap">
    <aside>
      <!-- Filtrer sur -->
      <div class="card">
        <div class="cardTitle">Filtrer sur</div>
        <label class="label">Jeu de données affiché</label>
        <select id="level">
          <option value="all">Toutes les couches visibles</option>
          <option value="Limites_departements_congo">Limites départements</option>
          <option value="Chef_lieu_departement">Chefs-lieux départements</option>
          <option value="Chef_lieu_district">Chefs-lieux districts</option>
          <option value="Reseau_routier_structurant">Réseau routier structurant</option>
        </select>
        <div class="hint">Astuce : pour filtrer réellement, utilise les cases à cocher ci-dessous.</div>
      </div>

      <!-- Couches -->
      <div class="card">
        <div class="cardTitle">Couches</div>
        <label class="check"><input type="checkbox" id="t_dep" checked> <span>Limites départements</span></label>
        <label class="check"><input type="checkbox" id="t_cld" checked> <span>Chefs-lieux départements</span></label>
        <label class="check"><input type="checkbox" id="t_cldist" checked> <span>Chefs-lieux districts</span></label>
        <label class="check"><input type="checkbox" id="t_routes"> <span>Réseau routier structurant</span></label>
      </div>

      <!-- Téléchargements -->
      <div class="card" id="downloads">
        <div class="cardTitle">Téléchargements</div>
        <div class="hint">Formats : SHP (ZIP) pour SIG • GeoJSON pour web.</div>

        <div class="dl">
          <div class="dlItem">
            <div class="dlTitle"><span class="tag admin">ADMIN</span> Limites départements</div>
            <div class="dlLinks">
              <a class="btn" href="data/shp/Limites_departements_congo/Limites_departements_congo.zip">SHP (ZIP)</a>
              <a class="btn" href="data/geojson/Limites_departements_congo/limites_departements_congo.geojson">GeoJSON</a>
            </div>
          </div>

          <div class="dlItem">
            <div class="dlTitle"><span class="tag points">POINTS</span> Chefs-lieux départements</div>
            <div class="dlLinks">
              <a class="btn" href="data/shp/Chef_lieu_departement/Chef_lieu_departement.zip">SHP (ZIP)</a>
              <a class="btn" href="data/geojson/Chef_lieu_departement/chef_lieu_departement.geojson">GeoJSON</a>
            </div>
          </div>

          <div class="dlItem">
            <div class="dlTitle"><span class="tag points">POINTS</span> Chefs-lieux districts</div>
            <div class="dlLinks">
              <a class="btn" href="data/shp/Chef_lieu_district/Chef_lieu_district.zip">SHP (ZIP)</a>
              <a class="btn" href="data/geojson/Chef_lieu_district/chef_lieu_district.geojson">GeoJSON</a>
            </div>
          </div>

          <div class="dlItem">
            <div class="dlTitle"><span class="tag routes">ROUTES</span> Réseau routier structurant</div>
            <div class="dlLinks">
              <a class="btn" href="data/shp/Reseau_routier_structurant/Reseau_routier_structurant.zip">SHP (ZIP)</a>
              <a class="btn" href="data/geojson/Reseau_routier_structurant/reseau_routier_structurant.geojson">GeoJSON</a>
            </div>
          </div>
        </div>

        <div class="hint">
          Si un ZIP ne marche pas : vérifie que le fichier existe avec exactement le même nom (majuscules/minuscules comprises).
        </div>
      </div>
    </aside>

    <section class="mapwrap">
      <div class="maphead">
        <div class="badgeRow">
          <span class="miniBadge">Fond : OpenStreetMap</span>
          <span class="miniBadge">Portail : GitHub Pages</span>
        </div>
        <span class="miniBadge">© IGN / Open Data</span>
      </div>
      <div id="map"></div>
    </section>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const DATASETS = [
      {
        key: "Limites_departements_congo",
        label: "Limites départements",
        geojson: "data/geojson/Limites_departements_congo/limites_departements_congo.geojson",
        toggleId: "t_dep",
        defaultVisible: true
      },
      {
        key: "Chef_lieu_departement",
        label: "Chefs-lieux départements",
        geojson: "data/geojson/Chef_lieu_departement/chef_lieu_departement.geojson",
        toggleId: "t_cld",
        defaultVisible: true
      },
      {
        key: "Chef_lieu_district",
        label: "Chefs-lieux districts",
        geojson: "data/geojson/Chef_lieu_district/chef_lieu_district.geojson",
        toggleId: "t_cldist",
        defaultVisible: true
      },
      {
        key: "Reseau_routier_structurant",
        label: "Réseau routier structurant",
        geojson: "data/geojson/Reseau_routier_structurant/reseau_routier_structurant.geojson",
        toggleId: "t_routes",
        defaultVisible: false
      }
    ];

    const map = L.map("map").setView([-1.0, 15.3], 6);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "&copy; OpenStreetMap contributors"
    }).addTo(map);

    const elStatusText = document.getElementById("statusText");
    const elStatusDot = document.getElementById("statusDot");
    const elLevel = document.getElementById("level");

    let layersByKey = {};
    let boundsAll = null;

    function setStatus(ok, fail){
      if(fail === 0 && ok > 0){
        elStatusDot.className = "dot ok";
        elStatusText.textContent = `OK ${ok} couche(s)`;
      } else if(ok === 0){
        elStatusDot.className = "dot bad";
        elStatusText.textContent = `OK 0 • ⚠️ ${fail} manquant(s)`;
      } else {
        elStatusDot.className = "dot";
        elStatusText.textContent = `OK ${ok} • ⚠️ ${fail} manquant(s)`;
      }
    }

    function styleByKey(key){
      if(key === "Limites_departements_congo"){
        return { color: "#16a34a", weight: 2, fillOpacity: 0.05 };
      }
      if(key === "Reseau_routier_structurant"){
        return { color: "#ef4444", weight: 2, opacity: 0.9 };
      }
      return { color: "#f59e0b", weight: 2, opacity: 0.9, fillOpacity: 0.9 };
    }

    function markerByKey(key){
      // points (chefs-lieux)
      return { radius: 6, color: "#0b1220", weight: 1, fillColor: "#f59e0b", fillOpacity: 0.95 };
    }

    async function loadDataset(ds){
      const res = await fetch(ds.geojson);
      if(!res.ok) throw new Error(`Non chargé: ${ds.geojson}`);
      const gj = await res.json();

      const layer = L.geoJSON(gj, {
        style: () => styleByKey(ds.key),
        pointToLayer: (feature, latlng) => L.circleMarker(latlng, markerByKey(ds.key)),
        onEachFeature: (feature, l) => {
          const props = feature.properties || {};
          const name = props.nom ?? props.NOM ?? props.NAME ?? props.Nom ?? "Sans nom";
          l.bindPopup(`<b>${name}</b><br><span style="font-size:12px;color:#666">${ds.label}</span>`);
        }
      });

      layersByKey[ds.key] = layer;

      const b = layer.getBounds();
      if(b.isValid()) boundsAll = boundsAll ? boundsAll.extend(b) : b;

      return layer;
    }

    function syncVisibility(){
      for(const ds of DATASETS){
        const cb = document.getElementById(ds.toggleId);
        const layer = layersByKey[ds.key];
        if(!layer || !cb) continue;

        const on = cb.checked;
        const has = map.hasLayer(layer);
        if(on && !has) layer.addTo(map);
        if(!on && has) map.removeLayer(layer);
      }
    }

    function applyLevelSelection(){
      const v = elLevel.value;
      if(v === "all") return;

      // Active uniquement la couche choisie (si elle existe)
      for(const ds of DATASETS){
        const cb = document.getElementById(ds.toggleId);
        if(!cb) continue;
        cb.checked = (ds.key === v);
      }
      syncVisibility();
    }

    (async function init(){
      setStatus(0, DATASETS.length);

      let ok = 0, fail = 0;
      for(const ds of DATASETS){
        try{
          await loadDataset(ds);
          ok++;
        }catch(e){
          console.error(e);
          fail++;
        }
      }

      // état initial
      for(const ds of DATASETS){
        const cb = document.getElementById(ds.toggleId);
        if(cb) cb.checked = ds.defaultVisible;
      }
      syncVisibility();

      if(boundsAll?.isValid()) map.fitBounds(boundsAll, {padding:[20,20]});

      // events
      for(const ds of DATASETS){
        document.getElementById(ds.toggleId)?.addEventListener("change", syncVisibility);
      }
      elLevel.addEventListener("change", applyLevelSelection);

      setStatus(ok, fail);
    })();
  </script>
</body>
</html>
